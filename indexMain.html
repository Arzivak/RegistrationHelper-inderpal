<!doctype html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="js/runScript.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">
        <link rel="stylesheet" href="css/styleIndex.css">
    </head>

    <body onload="loadClasses(); loadSemesters();">

        <!--Titile--------------------------------------------------------------->
        <section class="section" style="background:royalblue;">
            <div class="container">
                <h1 class="title" style="color:white;">Registration Helper</h1>
                <h2 class="subtitle" style="color:white">
                &nbsp; A plan to smooth progression.
                </h2>
            </div>
        </section>

        <!--Area columns--------------------------------------------------------->
        <div class="columns">
            <div class="column is-two-fifths" >
                <div class="box majorSearch">
                    <div>
                        <h1><strong>Search your major</strong></h1>
                    </div>
                    <div class="field has-addons">
                        <div class="control">
                            <input list="majors" type="text" name="majorSearch" placeholder="Computer Science">
                                <datalist id="majors">
                                    <option value="Computer Science">
                                    <option value="Information Technology">
                                    <option value="Mechanical Engineering">
                                    <option value="Electrical Engineering">
                                </datalist>
                                <input type="submit"></input>
                            </input>
                        </div>
                    </div>
                </div>
                <div style="margin:25px 0px 0px 2px;">
                    <h1><strong>Curriculum</strong></h1>
                </div>

                <div class="menu cirMenu">
                    <ul class="menu-list innerMenu" id="classesMenu">
                        <script>
                            function loadClasses() {
                                var xmlhttp = new XMLHttpRequest();
                               //[{group:gur name, classes:[{class:Cs 100, detail:[description]},{class:Cs 113, detail:[description],pre:[],available:0-1-2}]}]
                                xmlhttp.onreadystatechange = function() {
                                    if (this.readyState == 4 && this.status == 200) {
                                        var result = JSON.parse(this.responseText);
                                        //extract only groups
                                        var tempGroupArr =[];
                                        var final=[];
                                        var refined={};
                                        var classes = [];
                                        var inDict = {};
                                        var classDetail = [];
                                        var prer = [];
                                        var check = false;
                                        var index;
                                        for (x in result) {
                                            if(!(tempGroupArr.includes(result[x].group))) {
                                                tempGroupArr.push(result[x].group);
                                                final.push({"group":result[x].group});
                                            }
                                        }
                                        txt="";

                                        for (x in final) {
                                            final[x]["classes"]=[];
                                            for(i in result) {
                                                if(final[x]["group"] == result[i]["group"]){
                                                    classDetail = [];

                                                    inDict = {};
                                                    inDict = {"class":"","detail":classDetail};
                                                    index = result[i].order-1;
                                                    inDict["class"]=result[i].class;
                                                    inDict["code"] = result[i].code;
                                                    if(result[i].prereqs.length == 0) {
                                                        check = true;
                                                    }
                                                    else {
                                                        for(y in result[i].prereqs){

                                                           prer.push(result[i].prereqs[y].prereq);
                                                           if(result[i].prereqs[y].logic == 'OR' && result[i].prereqs[y].code != null){
                                                               check = true;
                                                           }
                                                           else if (result[i].prereqs[y].logic == 'OR' && result[i].prereqs[y].code == null){
                                                               check = false;
                                                           }
                                                           else if (result[i].prereqs[y].logic == 'AND' && result[i].prereqs[y].code != null){
                                                               check = true;
                                                           }
                                                           else if (result[i].prereqs[y].logic == 'AND' && result[i].prereqs[y].code == null){
                                                               check = false;
                                                           }
                                                          // if(result[i].prereqs[y].logic == null && result[i].prereqs[y].code != null) {
                                                            //   check = true;
                                                           //}
                                                           //else {
                                                             //  check = false;
                                                           //}
                                                        }
                                                    }
                                                    if(check == true) {
                                                        inDict["available"] = 0;
                                                    }
                                                    else {
                                                        inDict["available"] = 1;
                                                    }
                                                    //this make the prereq array and then empty it for next class
                                                    if(prer.length == 0){
                                                        prer.push("No Prereq");
                                                    }
                                                    inDict["pre"]=prer;
                                                    prer=[];

                                                    classDetail.push(result[i].description);
                                                    inDict["detail"]=classDetail;
                                                    final[x]["classes"].push(inDict);

                                                }


                                            }
                                        }
                                        for(x in final) {
                                            txt += "<li class=\"gurList\">" +
                                                    "<a class=\"is-active\">" + final[x].group + "</a>" +
                                                    "<ul>";
                                                    for(i in final[x].classes) {
                                                        if(final[x].classes[i].code != null){
                                                            txt+= "<li class=\"blueClass h\" >" +
                                                                    "<a>" + final[x].classes[i].class + " (" + final[x].classes[i].detail +")" +
                                                                    "<span class=\"hoverText\">"+ final[x].classes[i].pre+"</span>" + "</a>"+
                                                                "</li>";
                                                        }
                                                        else {
                                                            if(final[x].classes[i].available == 0){
                                                                txt+= "<li class=\"greenClass h\" >" +
                                                                    "<a>" + final[x].classes[i].class + " (" + final[x].classes[i].detail +")" +
                                                                    "<span class=\"hoverText\">"+ final[x].classes[i].pre+"</span>" + "</a>"+
                                                                "</li>";
                                                            }
                                                            else {
                                                                txt+= "<li class=\"redClass h\" >" +
                                                                    "<a>" + final[x].classes[i].class + " (" + final[x].classes[i].detail +")" +
                                                                    "<span class=\"hoverText\">"+ final[x].classes[i].pre+"</span>" + "</a>"+
                                                                "</li>";
                                                            }
                                                        }
                                                    }
                                                    txt+= "</ul>" +
                                                "</li>";
                                        }
                                        document.getElementById("classesMenu").innerHTML = txt;
                                    }
                                };
                                xmlhttp.open("GET", "../getAllClassesStudent.php", true);
                                xmlhttp.send();
                            }

                        </script>

                    </ul>
                </div>
            </div>

            <div class="column">
                <div>
                    <h1><strong>Plan Your Semesters</strong></h1>
                </div>

                <div class="box">
                    <div>
                        <button type="button" onclick="createSemester()">Add Semester</button>
                    </div>
                    <div id="createSem" class="semBox-dynamic">
                            Semester Name:
                            <input class="style-component-add-Sem" type="text" id="semesterName"><br>
                            <label class="radio style-component-add-Sem">
                                <input type="radio" name="sem" class="sem">
                                    SPRING
                            </label>
                            <label class="radio style-component-add-Sem">
                                <input type="radio" name="sem" class="sem">
                                    FALL
                            </label><br>
                            Year: <input class="style-component-add-Sem" type="number" min="2000" max="3000" id="year"><br>
                            <button class="style-component-add-Sem" type="button" onclick="addClass()">Add Class</button>
                            <div id="addClasses" class="box add-class-field">
                            </div>
                        <button type="button" onclick="sumbmitSemester()" >Submit</button>
                        <!--onclick="sumbmitSemester()-->
                    </div>
                </div>


                <div class="box">
                    <div id="fillSemester" onload="loadSemesters()" class="flex-container">

                    </div>
                </div>

                <script>
                    function createSemester() {
                        //make it first equal the already innerhtml and then add new and after click submit button enable add button
                        var x = document.getElementById("createSem");
                        x.style.display = "block";
                        document.getElementById("addClasses").innerHTML = "";
                        document.getElementById("year").innerHTML = "";
                        document.getElementsByClassName('sem')[0].checked = false;
                        document.getElementsByClassName('sem')[1].checked = false;
                        document.getElementById('semesterName').value = '';
                    }

                    function addClass() {
                        var addClass = document.createElement("addClass");
                        addClass.innerHTML = "<input type=\"text\" class=\"eachClass\" name=\"semester name\">";
                        document.getElementById("addClasses").appendChild(addClass);
                    }

                    function loadSemesters() {
                        var xmlhttp = new XMLHttpRequest();
                        xmlhttp.onreadystatechange = function() {
                            if (this.readyState == 4 && this.status == 200) {
                                var result = JSON.parse(this.responseText);
                                var final = [];
                                var semester = {};
                                var cls = [];
                                var tempCodeLst = [];
                                var txt = "";
                                for(x in result) {
                                    if(result[x].code != null) {
                                        if(final.length > 0) {
                                            for(j in final)
                                            {
                                                if(result[x].code == final[j].code) {
                                                    //semester["code"] = result[x].code;
                                                    final[j].classes.push(result[x].class);
                                                }
                                                else {
                                                    semester["code"] = result[x].code;
                                                    cls.push(result[x].class);
                                                    semester["classes"] = cls;
                                                    cls = [];
                                                    final.push(semester);
                                                    semester={};
                                                }
                                            }
                                        }
                                        else {
                                            semester["code"] = result[x].code;
                                            cls.push(result[x].class);
                                            semester["classes"] = cls
                                            final.push(semester);
                                            cls = [];
                                            semester={};
                                        }
                                    }
                                }
                                //final.sort(function(a, b){return a.code[2] - b.year[2]});
                                var z = 0;
                                for(i in final){

                                  //txt = "";
                                  txt += "<div class=\"semBox-display\">"+

                                            "<p class=\"semesterName\">Semester Name: "+ final[i].code[0];
                                            if(final[i].code[1] == "F"){
                                                txt+="&nbsp  &nbsp &nbsp Fall</p>";
                                            }
                                            else {
                                                txt+="&nbsp  &nbsp &nbsp Spring</p>";
                                            }
                                            txt+="<p> YEAR </p>"+
                                            "<div class=\"box display-class-field\">";

                                            for(k in final[i].classes){
                                                z=k;
                                                z++;
                                                txt+="<p> Class "+z+": "+final[i].classes[k] +"</p>";
                                            }
                                            txt+="</div>"+

                                            //in JS hAVE A FOR LOOP TO make class1: Cs100 class 2 class3-->
                                            "<button type=\"button\" onclick=\"editSemester()\">EDIT</button>"+
                                            //edit will add all the values in the semester to creatre a nw semester boxand delet the semester and sumbit the semester will repopulate it-->
                                        "</div>  ";

                                }
                                document.getElementById("fillSemester").innerHTML = txt;
                            }
                        };
                        xmlhttp.open("GET", "../getAllClassesStudent.php", true);
                        xmlhttp.send();
                    }

                    //function sumbmitSemester() {
                        // sumbit the new semester created, hide the form and execute the loadSemester  function again.

                        //$(document).ready(function(){



                            /*var c = document.getElementById("v");
                            $(c).click(function(){
                                $.post("../updateStudentRecords.php",
                                  final,function(){
                                      loadSemesters();
                                  }
                                );
                            });
                        });*/

                    //}

                    function sumbmitSemester() {

                      var x = document.getElementById("createSem");
                        x.style.display = "none";
                        var semesterName = document.getElementById("semesterName").value;
                        var classes = [];
                        var arr = document.getElementsByClassName('eachClass');
                        for(i=0 ; i < arr.length ; i++) {
                            classes.push(arr[i].value);
                        }
                        var code ="";
                        code+=semesterName;
                        if( document.getElementsByClassName('sem')[0].checked == true) {
                            code+="S1";
                        }
                        else {
                            code+="F1";
                        }
                        var final=[];
                        var di ={}
                        for(j in classes) {
                            di["name"]=classes[j];
                            di["ucid"]="mgt23";
                            di["code"]=code;
                            di["major"]="Science1";
                            final.push(di);
                            di={};
                        }

                        var f={"x":final};
                        var finals = JSON.stringify(f);

                      $.post('../updateStudentRecords.php',f,(data, textStatus, jqXHR) => {console.log(data); loadSemesters(); loadClasses();},"text");
                    }

                    function editSemter() {
                        var x = document.getElementById("createSem");
                        x.style.display = "block";

                    }
                </script>
                <!--while loop to keep doing the the button click-->
            </div>
        </div>

    </body>
</html>
